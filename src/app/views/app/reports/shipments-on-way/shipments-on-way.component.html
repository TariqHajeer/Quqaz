<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="line-scale-party" [fullScreen]="true">
  <p style="color: white"> </p>
</ngx-spinner>
<div class="card">
  <div class="card-body">
    <h3>كشف شحنات المندوب التي في الطريق </h3>
    <div class="row">
      <div class="col-md-2">
        <label>المندوب</label>
        <ng-select [(ngModel)]="Agent" [ngModelOptions]="{standalone: true}" [closeOnSelect]="true" name="Agent"
          (change)="ChangeAgentId()">
          <ng-option *ngFor="let Agent of Agents" [value]="Agent">{{Agent.name}}</ng-option>
        </ng-select>
      </div>
      <div class="col-md-2">
        <label>المحافظة</label>
        <ng-select [(ngModel)]="filtering.CountryId" [ngModelOptions]="{standalone: true}" [closeOnSelect]="true"
          name="Country" (change)="ChangeAgentId()">
          <ng-option *ngFor="let Country of countriesAgent" [value]="Country.id">{{Country.name}}</ng-option>
        </ng-select>
      </div>
      <div class="col-md-2">
        <label> رقم طباعة شحنات المندوب </label>
        <input type="text" class="form-control" (keyup)="ChangeAgentId()" [ngModelOptions]="{standalone: true}"
          [(ngModel)]="filtering.AgentPrintNumber">
      </div>
      <div class="col-md-2">
        <label> من تاريخ</label>
        <ejs-datepicker name="FromDate" [(ngModel)]='filtering.AgentPrintStartDate' (ngModelChange)="ChangeAgentId()"
          id="fromdate" placeholder='اختر تاريخ'>
        </ejs-datepicker>
      </div>
      <div class="col-md-2">
        <label> الى تاريخ</label>
        <ejs-datepicker name="FromDate" [(ngModel)]='filtering.AgentPrintEndDate' (ngModelChange)="ChangeAgentId()"
          id="fromdate" placeholder='اختر تاريخ'>
        </ejs-datepicker>
      </div>

      <div class="col-md-3">
        <button (click)="saveEdit()" class="btn btn-primary"> حفظ</button>&nbsp;
        <button (click)="print()" class="btn btn-primary"> <svg xmlns="http://www.w3.org/2000/svg" width="17"
            height="17" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">
            <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z" />
            <path
              d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z" />
          </svg> &nbsp;المعاينة قبل الطباعة</button>
      </div>
    </div>
    <div class="row">
      <div class="col-6">

      </div>

      <div class="col-2">
        <label>حالة الشحنة</label>
        <ng-select appendTo="body" [(ngModel)]="OrderplacedId" [ngModelOptions]="{standalone: true}" [clearable]="false"
          name="Orderplaced" (ngModelChange)="changeOrderPlaced()" style="width: 120px; overflow: visible;">
          <ng-option *ngFor="let order of orderPlace " [value]="order">{{order.name}}</ng-option>
        </ng-select>
      </div>
      <div class="col-2">
        <label>موقع المبلغ</label>
        <ng-select appendTo="body" [(ngModel)]="MoenyPlacedId" [ngModelOptions]="{standalone: true}"
          style="width: 140px;" [clearable]="false" (ngModelChange)="changeMoenyPlaced()" name="MonePlaced">
          <ng-option *ngFor="let moenyPlaced of getMoenyPlaced" [value]="moenyPlaced">{{moenyPlaced.name}}
          </ng-option>
        </ng-select>
      </div>
      <div class="col-3">

      </div>
    </div>

  </div>
</div>
<div class="example-container mat-elevation-z8">
  <table class="table">
    <thead>
      <th *ngFor="let th of thead">
        {{th=='اختر' ?null:th}}
        <div class="form-check" style="margin-bottom: 10px;">
          <input class="form-check-input" type="checkbox" *ngIf="th=='اختر'"/>
        </div>
      </th>
    </thead>
    <tbody>
      <tr *ngFor="let order of getorders; index as i" style="padding: 5px;">
        <td>
          <div class="form-check">
            <input class="form-check-input" [(ngModel)]="order.canEditOrder" name="canEditOrder" type="checkbox" />
          </div>
        </td>
        <td>{{i+1}}</td>
        <td>{{order.order.code}}</td>
        <td>{{order.order.client?order.order.client.name:null}}</td>
        <td>{{order.order.country?order.order.country.name:null}}</td>
        <td>{{order.order.region?order.order.region.name:null}}</td>
        <td>{{order.order.agentCost}}</td>
        <td>
          <h4 *ngIf="!order.canEditCost">{{order.order.cost}}</h4>
          <input type="text" class="form-control" [ngModelOptions]="{standalone: true}" *ngIf="order.canEditCost"
            oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"
            [(ngModel)]="order.order.cost" (ngModelChange)=" changeCost(element,i)" style="width: 110px;">
        </td>
        <td>{{order.order.deliveryCost}}</td>
        <td>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check2"
          viewBox="0 0 16 16" *ngIf="order.order.isClientDiliverdMoney==true">
          <path
            d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" />
        </svg>

        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x"
          viewBox="0 0 16 16" *ngIf="order.order.isClientDiliverdMoney==false">
          <path
            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
        </svg>
        </td>
        <td>
          <h4 *ngIf="!order.canEditOrder">{{order.order.orderplaced.name}}</h4>
          <ng-select appendTo="body" *ngIf="order.canEditOrder" [(ngModel)]="order.order.orderplaced.id" [ngModelOptions]="{standalone: true}"
          [clearable]="false" id="i*2" name="Orderplaced" (change)="ChangeOrderplacedId(element,i)"
          style="width: 120px; overflow: visible;">
          <ng-option *ngFor="let order of order.OrderPlaced" [value]="order.id">{{order.name}}</ng-option>
        </ng-select>
        </td>
        <td>
          <h4 *ngIf="!order.canEditOrder">{{order.order.monePlaced.name}}</h4>
          <ng-select appendTo="body" *ngIf="order.canEditOrder" [(ngModel)]="order.order.monePlaced.id" [ngModelOptions]="{standalone: true}"
          style="width: 120px;" [clearable]="false" name="MonePlaced" id="i*5">
          <ng-option *ngFor="let moenyPlaced of order.MoenyPlaced" [value]="moenyPlaced.id">{{moenyPlaced.name}}
          </ng-option>
        </ng-select>
        </td>
        <td>{{order.order.agentPrintNumber}}</td>
        <td>{{order.order.clientPrintNumber}}</td>
      </tr>
      <tr *ngIf="noDataFound">
        <td colspan="14">لايوجد بيانات للعرض</td>
      </tr>
      <tr *ngIf="getorders.length>0">
        <td colspan="7">الإجمالي</td>
        <td>{{totalCost}}</td>
        <td> {{totalDelaveryCost}}</td>
        <td> الإجمالي النهائي </td>
        <td colspan="4">{{endTotal}} </td>
      </tr>
    </tbody>
  </table>

</div>

<simple-notifications></simple-notifications>